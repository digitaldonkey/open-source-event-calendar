{"version":3,"file":"osec-big-cal.bundle.js.js?ver=a1597072a7d9520f8ce0","mappings":";;;;;;;;;;;;;AAIA;;AAOA,MAAMA,SAAS,CAAC;EAGfC,WAAWA,CAACC,KAAiB,EAAE;IAC9B,IAAI,CAACA,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC;EAChB;EAEAC,QAAQA,CAAEC,QAAa,EAAEC,MAAW,EAAC;IACpC;IACA,IAAIC,KAAK,GAAG,IAAI,CAACL,KAAK,CAACG,QAAQ,CAAC,CAACG,OAAO,CAAC,KAAK,CAAC;IAC/C;IACA;IACA;IACA;IACA;IACA;IACA,IAAIC,GAAG,GAAG,IAAI,CAACP,KAAK,CAACI,MAAM,CAAC,CAACE,OAAO,CAAC,KAAK,CAAC;IAC3C;IACA,IAAIC,GAAG,CAACC,QAAQ,CAACH,KAAK,CAAC,EAAE;MACxB,CAACE,GAAG,EAAEF,KAAK,CAAC,GAAG,CAACA,KAAK,EAAEE,GAAG,CAAC;IAC5B;IACA;IACA,IAAIE,WAAW,GAAG,IAAI,CAACT,KAAK,CAACK,KAAK,CAAC;IACnC,MAAMK,KAAK,GAAG,CAAC,CAAC;IAChB,MAAMC,KAAK,GAAG,EAAE;IAChB,OAAOF,WAAW,CAACD,QAAQ,CAACD,GAAG,CAAC,IAAIE,WAAW,CAACG,MAAM,CAACL,GAAG,CAAC,EAAE;MAC5D,MAAMM,SAAS,GAAGC,MAAM,CAACL,WAAW,CAACM,IAAI,CAAC,CAAC,CAAC;MAC5C,IAAI,IAAI,CAACd,KAAK,CAACY,SAAS,CAAC,EAAE;QAC1BF,KAAK,CAACK,IAAI,CAAC,IAAI,CAACf,KAAK,CAACY,SAAS,CAAC,CAAC;QACjCH,KAAK,CAACG,SAAS,CAAC,GAAG,IAAI;MACxB,CAAC,MACI;QACJH,KAAK,CAACG,SAAS,CAAC,GAAG,KAAK;MACzB;MACA;MACAJ,WAAW,GAAGA,WAAW,CAACQ,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC;IACxC;IACA;IACA;IACA;;IAEA,MAAMC,IAAI,GAAG;MACZR,KAAK;MACLL,KAAK,EAAE;QACNc,IAAI,EAAEd,KAAK,CAACe,MAAM,CAAC,CAAC;QACpBL,IAAI,EAAEV,KAAK,CAACU,IAAI,CAAC;MAClB,CAAC;MACDR,GAAG,EAAE;QACJY,IAAI,EAAEZ,GAAG,CAACa,MAAM,CAAC,CAAC;QAClBL,IAAI,EAAER,GAAG,CAACQ,IAAI,CAAC;MAChB,CAAC;MACDM,MAAM,EAAEV,KAAK;MACbW,OAAO,EAAE,IAAI,CAACC,gBAAgB,CAACb,KAAK;IACrC,CAAC;IACD;IACA,OAAOQ,IAAI;EACZ;EAEAD,GAAGA,CAAEO,KAAY,EAAO;IACvB,KAAK,IAAIX,SAAS,IAAIY,MAAM,CAACC,IAAI,CAACF,KAAK,CAAC,EAAE;MACzC;MACA,IAAI,IAAI,CAACxB,KAAK,CAACe,IAAI,CAACY,QAAQ,CAACd,SAAS,CAAC,CAAC,CAACe,OAAO,CAAC,CAAC,EAAE;QACnD,IAAI,CAAC3B,KAAK,CAACY,SAAS,CAAC,GAAGW,KAAK,CAACX,SAAS,CAAC;MACzC;IACD;EACD;EAEAgB,KAAKA,CAAA,EAAS;IACb,KAAK,MAAMhB,SAAS,IAAIY,MAAM,CAACC,IAAI,CAAC,IAAI,CAACzB,KAAK,CAAC,EAAE;MAChD,OAAO,IAAI,CAACA,KAAK,CAACY,SAAS,CAAC;IAC7B;EACD;EAEAiB,cAAcA,CAAA,EAAS;IACtB,MAAMC,OAAO,GAAG,IAAI,CAACC,UAAU,CAAC,CAAC;IACjC,OAAO;MACN3B,KAAK,EAAE0B,OAAO,CAACE,EAAE,CAAC,CAAC,CAAC;MACpB1B,GAAG,EAAEwB,OAAO,CAACE,EAAE,CAAC,CAAC,CAAC;IACnB,CAAC;EACF;EACAC,YAAYA,CAAA,EAAU;IACrB,MAAM;MAAE3B;IAAI,CAAC,GAAG,IAAI,CAACuB,cAAc,CAAC,CAAC;IACrC,OAAOvB,GAAG,GAAGA,GAAG,GAAG,IAAI;EACxB;EAEA4B,YAAYA,CAAA,EAAW;IACtB,MAAM;MAAE9B;IAAM,CAAC,GAAG,IAAI,CAACyB,cAAc,CAAC,CAAC;IACvC,OAAOzB,KAAK,GAAGA,KAAK,GAAG,IAAI;EAC5B;;EAEA;AACD;AACA;EACC2B,UAAUA,CAAA,EAAY;IACrB,MAAMN,IAAI,GAAGD,MAAM,CAACC,IAAI,CAAC,IAAI,CAACzB,KAAK,CAAC;IACpCyB,IAAI,CAACU,IAAI,CAAC,UAASC,CAAC,EAAEC,CAAC,EAAC;MACvB,OAAOX,QAAQ,CAACW,CAAC,CAAC,GAAGX,QAAQ,CAACU,CAAC,CAAC;IACjC,CAAC,CAAC;IACF,OAAQX,IAAI,CAACa,MAAM,GAAGb,IAAI,CAACc,GAAG,CAACC,MAAM,CAAC,GAAG,EAAE;EAC5C;;EAEA;AACD;AACA;AACA;EACClB,gBAAgBA,CAACb,KAAK,EAAE;IACvB,IAAIgC,SAAgB,EAAEC,OAAc;IACpC,MAAMC,MAAc,GAAG,EAAE;IACzB,MAAMC,UAAU,GAAGpB,MAAM,CAACC,IAAI,CAAChB,KAAK,CAAC;IACrC,MAAMoC,WAAW,GAAED,UAAU,CAACZ,EAAE,CAAC,CAAC,CAAC,CAAC;IACpC,KAAK,IAAIpB,SAAS,IAAIgC,UAAU,EAAE;MACjC,IAAI,IAAI,CAAC5C,KAAK,CAACY,SAAS,CAAC,EAAE;QAC1B,IAAI6B,SAAS,EAAE;UACdE,MAAM,CAAC5B,IAAI,CAAC;YACXX,KAAK,EAAEsB,QAAQ,CAACe,SAAS,CAAC;YAC1BnC,GAAG,EAAEoB,QAAQ,CAACgB,OAAO;UACtB,CAAC,CAAC;UACFD,SAAS,GAAG,IAAI;QACjB,CAAC,MAAM;UACNC,OAAO,GAAG9B,SAAS;QACpB;MACD,CAAC,MACI;QACJ,IAAI6B,SAAS,EAAE;UACdC,OAAO,GAAG9B,SAAS;QACpB,CAAC,MACI;UACJ6B,SAAS,GAAG7B,SAAS;QACtB;MACD;MACA,IAAI6B,SAAS,IAAII,WAAW,KAAKjC,SAAS,EAAE;QAC3C+B,MAAM,CAAC5B,IAAI,CAAC;UACXX,KAAK,EAAEsB,QAAQ,CAACe,SAAS,CAAC;UAC1BnC,GAAG,EAAEoB,QAAQ,CAACd,SAAS;QACxB,CAAC,CAAC;MACH;IACD;IACA,OAAO+B,MAAM;EACd;AACD;AAEA,iEAAe9C,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzJoC;AACE;AACpC;AACiB;AACC;AACV;AACU;AACE;AAAA;AAE9C,MAAM8D,SAAS,GAAIC,QAAQ,IAAK;EAC/B;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC7D,mDAAY,CAACqD,6DAAO,CAAC;EACrBrD,mDAAY,CAACsD,8DAAQ,CAAC;EACtB,IAAIO,QAAQ,KAAK,IAAI,EAAE;IACtB7D,mDAAY,CAAC6D,QAAQ,CAAC;EACvB;AACD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,MAAMG,cAAc,GAAIC,KAAK,IAAK;EACjC;EACA,IAAIA,KAAK,CAACC,IAAI,IAAID,KAAK,CAACC,IAAI,KAAK,QAAQ,EAAE;IAC1CD,KAAK,CAACC,IAAI,GAAG,KAAK;EACnB;EACA,IAAID,KAAK,CAACC,IAAI,EAAE;IACfD,KAAK,CAACE,WAAW,GAAGF,KAAK,CAACC,IAAI;IAC9B,OAAOD,KAAK,CAACC,IAAI;EAClB;EACA,IAAID,KAAK,CAACG,SAAS,EAAE;IACpBH,KAAK,CAACG,SAAS,GAAGpE,iDAAU,CAAC2B,QAAQ,CAACsC,KAAK,CAACG,SAAS,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;EAClE;EACA,OAAOJ,KAAK;AACb,CAAC;AAED,MAAMK,YAAY,GAAGA,CAACC,WAAW,GAAG,IAAI,EAAEL,IAAI,KAAK;EAClD,MAAM/C,IAAI,GAAGM,MAAM,CAAC+C,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACH,WAAW,CAAC,KAAK,eAAe,GAAGvE,4CAAK,CAACuE,WAAW,CAAC,GAAGvE,4CAAK,CAAC,CAAC;EAC3G,MAAM2E,SAAS,GAAG;IAACtE,KAAK,EAAE,IAAI;IAAEE,GAAG,EAAE;EAAI,CAAC;EAC1C,QAAQ2D,IAAI;IACX,KAAK,OAAO;MACXS,SAAS,CAACtE,KAAK,GAAGc,IAAI,CAACb,OAAO,CAAC,OAAO,CAAC,CAACA,OAAO,CAAC,MAAM,CAAC,CAACS,IAAI,CAAC,CAAC;MAC9D4D,SAAS,CAACpE,GAAG,GAAGY,IAAI,CAACyD,KAAK,CAAC,OAAO,CAAC,CAACA,KAAK,CAAC,MAAM,CAAC,CAAC7D,IAAI,CAAC,CAAC;MACxD;IACD,KAAK,MAAM;MACV4D,SAAS,CAACtE,KAAK,GAAGc,IAAI,CAACb,OAAO,CAAC,MAAM,CAAC,CAACS,IAAI,CAAC,CAAC;MAC7C4D,SAAS,CAACpE,GAAG,GAAGY,IAAI,CAACyD,KAAK,CAAC,MAAM,CAAC,CAAC7D,IAAI,CAAC,CAAC;MACzC;IACD,KAAK,QAAQ;IACb,KAAK,KAAK;IACV;MACC4D,SAAS,CAACtE,KAAK,GAAGc,IAAI,CAACJ,IAAI,CAAC,CAAC;EAC/B;EACA,OAAO4D,SAAS;AACjB,CAAC;AAED,MAAME,cAAc,GAAGA,CAACnE,KAAK,EAAEwD,IAAI,KAAK;EACvCY,OAAO,CAACC,GAAG,CAAC;IAACrE,KAAK;IAAEwD;EAAI,CAAC,EAAE,uBAAuB,CAAC;EACnD,QAAQA,IAAI;IACX,KAAK,MAAM;MACV,OAAO;QACN7D,KAAK,EAAEK,KAAK,CAAC,CAAC,CAAC;QACfH,GAAG,EAAEG,KAAK,CAAC,CAAC;MACb,CAAC;IACF,KAAK,QAAQ;MACZ;MACA;MACA,OAAO;QACNL,KAAK,EAAEK,KAAK,CAACL,KAAK;QAClBE,GAAG,EAAE;MACN,CAAC;IACF,KAAK,KAAK;MACT,OAAO;QACNF,KAAK,EAAEK,KAAK,CAAC,CAAC,CAAC;QACfH,GAAG,EAAE;MACN,CAAC;IACF,KAAK,OAAO;IACZ;MACC,OAAOG,KAAK;EACd;AACD,CAAC;AAED,MAAMsE,cAAc,GAAGA,CAACZ,SAAS,GAAG,IAAI,KAAK;EAC5C,IAAIA,SAAS,EAAE;IACd,OAAOpE,iDAAU,CAAC2B,QAAQ,CAACyC,SAAS,CAAC,CAAC,CAAChD,MAAM,CAAC,CAAC;EAChD;EACA,OAAOpB,4CAAK,CAAC,CAAC,CAACoB,MAAM,CAAC,CAAC,CAAC,CAAC;AAC1B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,MAAM6D,UAAU,GAAG,MAAAA,CAAOvE,KAAK,EAAEwE,SAAS,KAAK;EAC9C,MAAMC,GAAG,GAAG,eAAe;EAC3B,MAAMC,IAAI,GAAG3B,4DAAY,CAAE0B,GAAG,EAAEzE,KAAM,CAAC;EACvC;EACA;EACA,MAAM2E,GAAG,GAAG,MAAM7B,2DAAQ,CAAC;IAAC4B;EAAI,CAAC,CAAC;EAClC,MAAME,QAAQ,GAAGD,GAAG,CAACE,MAAM,GAAGF,GAAG,CAACE,MAAM,GAAG,EAAE;EAC7CT,OAAO,CAACC,GAAG,CAACO,QAAQ,EAAE,aAAa,CAAC;EACpC,OAAOA,QAAQ;AAChB,CAAC;AAEc,SAASE,UAAUA,CAACvB,KAAK,EAAE;EACzC;EACA,MAAM;IAAEG,SAAS;IAAED;EAAY,CAAC,GAAGH,cAAc,CAACC,KAAK,CAAC;EACxD,MAAMJ,QAAQ,GAAGI,KAAK,CAACF,MAAM,CAAC0B,IAAI;EAClC7B,SAAS,CAACC,QAAQ,CAAC;EACnB,MAAM6B,SAAS,GAAGtC,kEAAc,CAACpD,8CAAK,CAAC;EACvC,MAAM,CAACuF,MAAM,EAAEL,SAAS,CAAC,GAAGjC,+CAAQ,CAAC,CAAC;IACrC,OAAO,EAAE,OAAO;IAChB,OAAO,EAAE,IAAI0C,IAAI,CAAC,0BAA0B,CAAC;IAC7C,KAAK,EAAE,IAAIA,IAAI,CAAC,0BAA0B,CAAC;IAC3C,QAAQ,EAAE,KAAK;IACf,UAAU,EAAE;EACb,CAAC,CAAC,CAAC;;EAEH;;EAEA;EACA;EACA;EACA;EACA;EACC,MAAMC,SAAS,GAAGtB,YAAY,CAACF,SAAS,EAAED,WAAW,CAAC;EACvD;EACA;EACA;EACA;EACA;EACA,MAAM;IAAE0B;EAAM,CAAC,GAAG7C,8CAAO,CAAC,MAAM;IAC/B,OAAO;MACNuB,WAAW,EAAES,cAAc,CAACZ,SAAS,CAAC;MACtCyB,MAAM,EAAEA,CAAA,KAAM7F,4CAAK,CAAC,CAAC,CAACoB,MAAM,CAAC,CAAC;MAC9BsE;MACA;MACA;IACD,CAAC;EACF,CAAC,CAAC;EAEFxC,gDAAS,CAAC,MAAM;IACf,eAAe4C,SAASA,CAACF,SAAS,EAAE;MACnC,MAAMT,GAAG,GAAG,eAAe;MAC3B,MAAMC,IAAI,GAAG3B,4DAAY,CAAE0B,GAAG,EAAES,SAAU,CAAC;MAC3C;MACA;MACA,MAAMG,QAAQ,GAAG,MAAMvC,2DAAQ,CAAC;QAAC4B;MAAI,CAAC,CAAC;MAEvC,IAAGW,QAAQ,CAACR,MAAM,EAAE;QACnB,MAAMA,MAAM,GAAGQ,QAAQ,CAACR,MAAM,CAAC/C,GAAG,CAACwD,KAAK,IAAI;UAC3C;UACA,OAAO;YACN,GAAGA,KAAK;YACR,GAAG;cACF3F,KAAK,EAAEL,iDAAU,CAAC2B,QAAQ,CAACqE,KAAK,CAAC3F,KAAK,CAAC,CAAC,CAACe,MAAM,CAAC,CAAC;cACjDb,GAAG,EAAEP,iDAAU,CAAC2B,QAAQ,CAACqE,KAAK,CAACzF,GAAG,CAAC,CAAC,CAACa,MAAM,CAAC;YAC7C;UACD,CAAC;QACF,CAAC,CAAC;QACF0D,OAAO,CAACC,GAAG,CAACQ,MAAM,EAAE,aAAa,CAAC;QAClCL,SAAS,CAACK,MAAM,CAAC;MAClB;IACD;IACAO,SAAS,CAACF,SAAS,CAAC;EACrB,CAAC,EAAE,CAACA,SAAS,EAAEV,SAAS,CAAC,CAAC;;EAE1B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,oBACCvB,sDAAA,CAACR,wDAAQ;IACRuC,SAAS,EAAEA,SAAU;IACrBH,MAAM,EAAEA;IACR;IAAA;IACAM,MAAM,EAAEA,MAAO;IACfI,WAAW,EAAC,KAAK;IACjBC,KAAK,EAAE;MAAEC,MAAM,EAAE;IAAO,CAAE;IAC1BhC,WAAW,EAAEA,WAAY;IACzBiC,aAAa,EAAIA,CAACC,QAAQ,EAAEC,WAAW,KAAK;MAC3C,MAAM5F,KAAK,GAAGmE,cAAc,CAACwB,QAAQ,EAAEC,WAAW,CAAC;MACnDxB,OAAO,CAACC,GAAG,CAAC;QAACrE;MAAK,CAAC,EAAE,wBAAwB,CAAC;IAC/C,CAAE;IACF6F,UAAU,EAAIC,OAAO,IAAK;MACzB;MACA1B,OAAO,CAACC,GAAG,CAAC;QAACyB;MAAO,CAAC,EAAE,SAAS,CAAC;IAClC,CAAE;IACFC,MAAM,EAAIC,OAAO,IAAK;MACrB;MACA5B,OAAO,CAACC,GAAG,CAAC;QAAC2B;MAAO,CAAC,EAAE,SAAS,CAAC;IAClC;EAAE,CACF,CAAC;AAEJ","sources":["webpack://calendar_block/./src/react-big-calendar/DateCache.ts","webpack://calendar_block/./src/react-big-calendar/OsecBigCal.js"],"sourcesContent":["import * as dayjs from 'dayjs'\n\nimport { log } from \"console\";\n\n// TODO MAYybe https://github.com/liesislukas/localstorage-ttl/\n\nexport interface Range {\n\tstart: number;\n\tend: number;\n}\n\nclass DateCache {\n\tdayjs: dayjs.Dayjs;\n\tcache: object;\n\tconstructor(dayjs:dayjs.Dayjs) {\n\t\tthis.dayjs = dayjs;\n\t\tthis.cache = {}\n\t}\n\n\tgetRange (startDay:Date, endDay:Date){\n\t\t// @ts-expect-error\n\t\tlet start = this.dayjs(startDay).startOf('day');\n\t\t// +1 day? to fill\n\t\t//   -> No: the API should return Events from start to end of a day.\n\t\t//      So there might just be a List of Events for a\n\t\t//      Unix time + 24 hours Range.\n\t\t//      - Will invalidate on timezone/locale change on frontend.\n\t\t// @ts-expect-error\n\t\tlet end = this.dayjs(endDay).startOf('day');\n\t\t// Ensure order.\n\t\tif (end.isBefore(start)) {\n\t\t\t[end, start] = [start, end];\n\t\t}\n\t\t// @ts-expect-error\n\t\tlet currentDate = this.dayjs(start);\n\t\tconst range = {};\n\t\tconst found = [];\n\t\twhile (currentDate.isBefore(end) || currentDate.isSame(end)) {\n\t\t\tconst timestamp = String(currentDate.unix());\n\t\t\tif (this.cache[timestamp]) {\n\t\t\t\tfound.push(this.cache[timestamp]);\n\t\t\t\trange[timestamp] = true\n\t\t\t}\n\t\t\telse {\n\t\t\t\trange[timestamp] = false\n\t\t\t}\n\t\t\t// Add a day.\n\t\t\tcurrentDate = currentDate.add(1, 'day');\n\t\t}\n\t\t//  Alle Tage generieren?\n\t\t//  Wie matchen?\n\t\t//  Wie fetchen?\n\n\t\tconst data = {\n\t\t\trange,\n\t\t\tstart: {\n\t\t\t\tdate: start.toDate(),\n\t\t\t\tunix: start.unix(),\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tdate: end.toDate(),\n\t\t\t\tunix: end.unix(),\n\t\t\t},\n\t\t\tcached: found,\n\t\t\tmissing: this.getMissingRanges(range),\n\t\t}\n\t\t// log(data);\n\t\treturn data;\n\t}\n\n\tadd (items:object):void {\n\t\tfor (let timestamp of Object.keys(items)) {\n\t\t\t// @ts-expect-error\n\t\t\tif (this.dayjs.unix(parseInt(timestamp)).isValid()) {\n\t\t\t\tthis.cache[timestamp] = items[timestamp];\n\t\t\t}\n\t\t}\n\t}\n\n\tpurge ():void {\n\t\tfor (const timestamp of Object.keys(this.cache)) {\n\t\t\tdelete this.cache[timestamp]\n\t\t}\n\t}\n\n\tgetCachedRange():Range {\n\t\tconst allKeys = this.getDaysAsc();\n\t\treturn {\n\t\t\tstart: allKeys.at(0),\n\t\t\tend: allKeys.at(-1)\n\t\t}\n\t}\n\tgetOldestDay():number {\n\t\tconst { end } = this.getCachedRange();\n\t\treturn end ? end : null;\n\t}\n\n\tgetNewestDay ():number {\n\t\tconst { start } = this.getCachedRange();\n\t\treturn start ? start : null;\n\t}\n\n\t/**\n\t * Get all ordered ascending/old to new.\n\t */\n\tgetDaysAsc():number[] {\n\t\tconst keys = Object.keys(this.cache);\n\t\tkeys.sort(function(a, b){\n\t\t\treturn parseInt(b) - parseInt(a)\n\t\t});\n\t\treturn  keys.length ? keys.map(Number) : [];\n\t}\n\n\t/**\n\t * Extract start/end of missing sections in range.\n\t * @param range\n\t */\n\tgetMissingRanges(range) {\n\t\tlet isMissing:string, lastOne:string;\n\t\tconst missed:Range[] = [];\n\t\tconst timestamps = Object.keys(range);\n\t\tconst lastElement= timestamps.at(-1);\n\t\tfor (let timestamp of timestamps) {\n\t\t\tif (this.cache[timestamp]) {\n\t\t\t\tif (isMissing) {\n\t\t\t\t\tmissed.push({\n\t\t\t\t\t\tstart: parseInt(isMissing),\n\t\t\t\t\t\tend: parseInt(lastOne),\n\t\t\t\t\t});\n\t\t\t\t\tisMissing = null;\n\t\t\t\t} else {\n\t\t\t\t\tlastOne = timestamp;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (isMissing) {\n\t\t\t\t\tlastOne = timestamp;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tisMissing = timestamp;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isMissing && lastElement === timestamp) {\n\t\t\t\tmissed.push({\n\t\t\t\t\tstart: parseInt(isMissing),\n\t\t\t\t\tend: parseInt(timestamp),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn missed;\n\t}\n}\n\nexport default DateCache;\n","import React, { useMemo, useState, useEffect } from 'react';\nimport { Calendar, dayjsLocalizer } from 'react-big-calendar';\nimport dayjs from \"dayjs\";\nimport weekday from 'dayjs/plugin/weekday';\nimport timezone from 'dayjs/plugin/timezone'\nimport {Range} from './DateCache';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\nconst initDayJs = (localeId) => {\n\t/**\n\t * Note that the dayjsLocalizer extends Day.js with the following plugins:\n\t *  IsBetween\n\t * \tIsSameOrAfter\n\t * \tIsSameOrBefore\n\t * \tLocaleData\n\t * \tLocalizedFormat\n\t * \tMinMax\n\t * \tUTC\n\t */\n\tdayjs.extend(weekday);\n\tdayjs.extend(timezone);\n\tif (localeId !== 'en') {\n\t\tdayjs.locale(localeId)\n\t}\n}\n\n/**\n * Maybe we won't need to do this if we have a dedicated Form later.\n * For now: Here is the place if Edit Form props and calendar props do not match.\n * @param props\n * @returns {*}\n */\nconst transformProps = (props) => {\n\t// View name \"oneday\" matches \"day\".\n\tif (props.view && props.view === 'oneday') {\n\t\tprops.view = 'day';\n\t}\n\tif (props.view) {\n\t\tprops.defaultView = props.view;\n\t\tdelete props.view;\n\t}\n\tif (props.fixedDate) {\n\t\tprops.fixedDate = dayjs.unix(parseInt(props.fixedDate)).valueOf();\n\t}\n\treturn props;\n}\n\nconst initialRange = (defaultDate = null, view) => {\n\tconst date = Object.prototype.toString.call(defaultDate) === '[object Date]' ? dayjs(defaultDate) : dayjs();\n\tconst returnVal = {start: null, end: null};\n\tswitch (view) {\n\t\tcase 'month':\n\t\t\treturnVal.start = date.startOf('month').startOf('week').unix();\n\t\t\treturnVal.end = date.endOf('month').endOf('week').unix();\n\t\t\tbreak;\n\t\tcase 'week':\n\t\t\treturnVal.start = date.startOf('week').unix();\n\t\t\treturnVal.end = date.endOf('week').unix();\n\t\t\tbreak;\n\t\tcase 'agenda':\n\t\tcase 'day':\n\t\tdefault:\n\t\t\treturnVal.start = date.unix();\n\t}\n\treturn returnVal;\n}\n\nconst transformRange = (range, view) => {\n\tconsole.log({range, view}, 'range (UNTRANSFORMED)');\n\tswitch (view) {\n\t\tcase 'week':\n\t\t\treturn {\n\t\t\t\tstart: range[0],\n\t\t\t\tend: range[6],\n\t\t\t}\n\t\tcase 'agenda':\n\t\t\t// TODO There are options to change default agenda Range.\n\t\t\t/// Agenda.range = (start, { length = Agenda.defaultProps.length })\n\t\t\treturn {\n\t\t\t\tstart: range.start,\n\t\t\t\tend: null,\n\t\t\t}\n\t\tcase 'day':\n\t\t\treturn {\n\t\t\t\tstart: range[0],\n\t\t\t\tend: null,\n\t\t\t}\n\t\tcase 'month':\n\t\tdefault:\n\t\t\treturn range;\n\t}\n}\n\nconst getDefaultDate = (fixedDate = null) => {\n\tif (fixedDate) {\n\t\treturn dayjs.unix(parseInt(fixedDate)).toDate();\n\t}\n\treturn dayjs().toDate(); // == new Date()\n}\n\n/**\n *\n * @param  range Range\n * @param setEvents\n * @returns {Promise<void>}\n */\nconst loadEvents = async (range, setEvents) => {\n\tconst url = '/osec/v1/days';\n\tconst path = addQueryArgs( url, range );\n\t// const {events} =\n\t// console.log({events} );\n\tconst res = await apiFetch({path});\n\tconst myReturn = res.events ? res.events : [];\n\tconsole.log(myReturn, '@loadEvents');\n\treturn myReturn;\n}\n\nexport default function OsecBigCal(props) {\n\t// console.log(props, 'props@OsecBigCal')\n\tconst { fixedDate, defaultView } = transformProps(props);\n\tconst localeId = props.locale.name;\n\tinitDayJs(localeId);\n\tconst localizer = dayjsLocalizer(dayjs);\n\tconst [events, setEvents] = useState([{\n\t\t\"title\": \"Daily\",\n\t\t\"start\": new Date(\"2025-04-29T15:16:00.000Z\"),\n\t\t\"end\": new Date(\"2025-04-29T16:16:00.000Z\"),\n\t\t\"allDay\": false,\n\t\t\"resource\": \"any\"\n\t}]);\n\n\t// const [view, setView] = useState(defaultView);\n\n\t// TODO\n\t//  This can be converted to a appropriate star Range\n\t//   --> loadEvents should have a filter to unify the renges\n\t//       Day/Week/Month/Agenda(?Pager, Initial set number or Autoload?)\n\t//\n\t const loadRange = initialRange(fixedDate, defaultView);\n\t// fixedDate should be relative to the\n\t// timespan start (e.g 1 Week Day at Day/Month views. Not on agenda).\n\t// Like firstVisibleDay to query Events.\n\t// console.log({loadRange })\n\t// ;\n\tconst { getNow} = useMemo(() => {\n\t\treturn {\n\t\t\tdefaultDate: getDefaultDate(fixedDate),\n\t\t\tgetNow: () => dayjs().toDate(),\n\t\t\tlocalizer,\n\t\t\t// loadRange: initialRange(fixedDate, defaultView),\n\t\t\t// scrollToTime: DateTime.local().toJSDate(),\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tasync function loadPosts(loadRange) {\n\t\t\tconst url = '/osec/v1/days';\n\t\t\tconst path = addQueryArgs( url, loadRange );\n\t\t\t// const {events} =\n\t\t\t// console.log({events} );\n\t\t\tconst response = await apiFetch({path});\n\n\t\t\tif(response.events) {\n\t\t\t\tconst events = response.events.map(event => {\n\t\t\t\t\t// console.log(dayjs.unix(parseInt(event.start)).toDate())\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...event,\n\t\t\t\t\t\t...{\n\t\t\t\t\t\t\tstart: dayjs.unix(parseInt(event.start)).toDate(),\n\t\t\t\t\t\t\tend: dayjs.unix(parseInt(event.end)).toDate(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconsole.log(events, '@loadEvents');\n\t\t\t\tsetEvents(events);\n\t\t\t}\n\t\t}\n\t\tloadPosts(loadRange);\n\t}, [loadRange, setEvents])\n\n\t// useEffect(async () => {\n\t// \tconst eventsRaw = await loadEvents(loadRange);\n\t// \tconst events = eventsRaw.map(event => {\n\t// \t\t// console.log(dayjs.unix(parseInt(event.start)).toDate())\n\t// \t\treturn {\n\t// \t\t\t...event,\n\t// \t\t\t...{\n\t// \t\t\t\tstart: dayjs.unix(parseInt(event.start)).toDate(),\n\t// \t\t\t\tend: dayjs.unix(parseInt(event.end)).toDate(),\n\t// \t\t\t}\n\t// \t\t}\n\t// \t});\n\t// \tconsole.log(events, '@useEffect');\n\t// \tsetEvents(events);\n\t// }, [events, loadRange]);\n\n\treturn (\n\t\t<Calendar\n\t\t\tlocalizer={localizer}\n\t\t\tevents={events}\n\t\t\t// date={  }\n\t\t\tgetNow={getNow}\n\t\t\tendAccessor=\"end\"\n\t\t\tstyle={{ height: '80vh' }}\n\t\t\tdefaultView={defaultView}\n\t\t\tonRangeChange = {(newRange, currentView) => {\n\t\t\t\tconst range = transformRange(newRange, currentView)\n\t\t\t\tconsole.log({range}, 'newRange (TRANSFORMED)')\n\t\t\t}}\n\t\t\tonNavigate ={(newDate) => {\n\t\t\t\t// Does not seem to fire.\n\t\t\t\tconsole.log({newDate}, 'newDate')\n\t\t\t}}\n\t\t\tonView ={(newView) => {\n\t\t\t\t// setView(newView);\n\t\t\t\tconsole.log({newView}, 'newView')\n\t\t\t}}\n\t\t/>\n\t)\n}\n"],"names":["DateCache","constructor","dayjs","cache","getRange","startDay","endDay","start","startOf","end","isBefore","currentDate","range","found","isSame","timestamp","String","unix","push","add","data","date","toDate","cached","missing","getMissingRanges","items","Object","keys","parseInt","isValid","purge","getCachedRange","allKeys","getDaysAsc","at","getOldestDay","getNewestDay","sort","a","b","length","map","Number","isMissing","lastOne","missed","timestamps","lastElement","React","useMemo","useState","useEffect","Calendar","dayjsLocalizer","weekday","timezone","Range","apiFetch","addQueryArgs","jsx","_jsx","initDayJs","localeId","extend","locale","transformProps","props","view","defaultView","fixedDate","valueOf","initialRange","defaultDate","prototype","toString","call","returnVal","endOf","transformRange","console","log","getDefaultDate","loadEvents","setEvents","url","path","res","myReturn","events","OsecBigCal","name","localizer","Date","loadRange","getNow","loadPosts","response","event","endAccessor","style","height","onRangeChange","newRange","currentView","onNavigate","newDate","onView","newView"],"sourceRoot":""}