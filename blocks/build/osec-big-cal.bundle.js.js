"use strict";(globalThis.webpackChunkcalendar_block=globalThis.webpackChunkcalendar_block||[]).push([[2242],{2775:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(1609),s=a(1356),r=a(4353),i=a.n(r),c=a(6986),o=a.n(c),d=a(8569),l=a.n(d);var h=a(1455),g=a.n(h),u=a(3832),f=a(5327),w=a(5011),y=a(790);function p(e){return console.log(e),(0,y.jsx)(w.A,{show:!0,children:(e,{arrowProps:t,popper:a,show:n})=>(0,y.jsx)("div",{...e,className:"absolute",children:"N.A."})})}const v=new class{constructor(e){this.dayjs=e,this.cache={}}getRange(e){if(!e.start||!e.end)throw new Error("invalid argument type");let t=this.dayjs(e.start).startOf("day"),a=this.dayjs(e.end).add(1,"day").startOf("day");a.isBefore(t)&&([a,t]=[t,a]);let n=this.dayjs(t);const s=[],r={};let i=[];for(;n.isBefore(a)||n.isSame(a);){const e=n.unix();Array.isArray(this.cache[String(e)])?(i=i.concat(this.cache[String(e)]),r[String(e)]=!0):null===this.cache[String(e)]?this.cache[String(e)]=[]:(s.push(e),this.cache[String(e)]=null,r[String(e)]=!1),n=n.add(1,"day")}return{temp:r,start:{date:t.local().format(),unix:t.unix()},end:{date:a.local().format(),unix:a.unix()},cached:i,missing:this.getMissingRanges(s)}}addRequest(e){e.map((e=>{const t=String(r(e.start).startOf("day").unix());Array.isArray(this.cache[t])||(this.cache[t]=[]),this.cache[t].push(e)}))}add(e){for(let t of Object.keys(e))this.dayjs.unix(parseInt(t)).isValid()&&(this.cache[t]=e[t])}purge(){for(const e of Object.keys(this.cache))delete this.cache[e]}getCachedRange(){const e=this.getDaysAsc();return{start:e.at(0),end:e.at(-1)}}getOldestDay(){const{end:e}=this.getCachedRange();return e||null}getNewestDay(){const{start:e}=this.getCachedRange();return e||null}getDaysAsc(){const e=Object.keys(this.cache);return e.sort((function(e,t){return parseInt(t)-parseInt(e)})),e.length?e.map(String):[]}getMissingRanges(e){const t=new Int32Array(e).sort();if(!t.length)return[];const a=[],n=86400;let s=t.at(0),r=null;return t.forEach((e=>{!(r&&r+n===e)&&r&&(a.push({start:String(s),end:String(r+n)}),s=e),r=e})),a.push({start:String(s),end:String(t.at(-1)+n)}),a}}(i());let x=e=>{};const S=e=>{i().extend(o()),i().extend(l()),"en"!==e&&i().locale(e)},D=e=>((0,n.useEffect)((()=>{e.onView(e.view)}),[]),(0,y.jsx)(f.A,{...e})),m=e=>(e.view&&"oneday"===e.view&&(e.view="day"),e.view&&(e.defaultView=e.view,delete e.view),e.fixedDate&&(e.fixedDate=i().unix(parseInt(e.fixedDate)).valueOf()),e),A=e=>e.map((e=>({...e,start:i().unix(parseInt(e.start)).toDate(),end:i().unix(parseInt(e.end)).toDate()}))),R=(e=null)=>e?i().unix(parseInt(e)).toDate():i()().toDate();function b(e){const{fixedDate:t,defaultView:a}=m(e),r=e.locale.name;S(r);const c=(0,s.vH)(i()),[o,d]=(0,n.useState)([]),[l,h]=(0,n.useState)(e.defaultView),f=(0,n.useCallback)((async e=>{const t={start:i()(1e3*e.start).local().toDate(),end:i()(1e3*e.end).local().endOf("day").toDate()};x({...t,range:e},"range@loadEvents");const a=v.getRange(t);if(a.cached.length&&(d(a.cached),x(a.cached,"FROM CACHE")),a.missing.length)for(const e of a.missing){x({start:i()(1e3*parseInt(e.start)).local().toString(),end:i()(1e3*parseInt(e.end)).local().toString()},"MISSING RANGE");const t=(0,u.addQueryArgs)("/osec/v1/days",e),a=await g()({path:t}),n=A(a.events);d((e=>[...e,...n])),v.addRequest(n),x({newEvents:n,cache:v},"FETCHED TO CACHE")}}),[d]),{getNow:w}=(0,n.useMemo)((()=>({defaultDate:R(t),getNow:()=>i()().toDate(),localizer:c})));return(0,y.jsx)(s.Vv,{localizer:c,events:o,getNow:w,endAccessor:"end",style:{height:"100vh",fontSize:".9rem"},defaultView:a,onRangeChange:(e,t)=>(x({newRange:e,view:l},"args@onRangeChange"),((e,t)=>{let a=e;switch(t){case"week":a={start:e[0],end:e[6]};break;case"agenda":a={start:e.start,end:i()(e.start).endOf("month").toDate()};break;case"day":a={start:e[0],end:i()(e[0]).endOf("day").toDate()}}return x({start:i()(a.start).toDate(),end:i()(a.end).toDate(),view:t},`loadRange for view: "${t}"`),f({start:i()(a.start).unix(),end:i()(a.end).unix()})})(e,null!=t?t:l)),onView:e=>{x(e,"onView"),h(e)},components:{toolbar:D},onSelectEvent:p})}}}]);