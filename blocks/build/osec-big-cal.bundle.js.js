"use strict";(globalThis.webpackChunkcalendar_block=globalThis.webpackChunkcalendar_block||[]).push([[2242],{448:(t,e,a)=>{a.r(e),a.d(e,{default:()=>R});var n=a(1609),s=a(4839),r=a(4353),i=a.n(r),c=a(6986),o=a.n(c),d=a(8569),l=a.n(d);var h=a(1455),g=a.n(h),u=a(3832),f=a(5327),y=a(790);const w=new class{constructor(t){this.dayjs=t,this.cache={}}getRange(t){if(!t.start||!t.end)throw new Error("invalid argument type");let e=this.dayjs(t.start).startOf("day"),a=this.dayjs(t.end).add(1,"day").startOf("day");a.isBefore(e)&&([a,e]=[e,a]);let n=this.dayjs(e);const s=[],r={};let i=[];for(;n.isBefore(a)||n.isSame(a);){const t=n.unix();Array.isArray(this.cache[String(t)])?(i=i.concat(this.cache[String(t)]),r[String(t)]=!0):null===this.cache[String(t)]?this.cache[String(t)]=[]:(s.push(t),this.cache[String(t)]=null,r[String(t)]=!1),n=n.add(1,"day")}return{temp:r,start:{date:e.local().format(),unix:e.unix()},end:{date:a.local().format(),unix:a.unix()},cached:i,missing:this.getMissingRanges(s)}}addRequest(t){t.map((t=>{const e=String(r(t.start).startOf("day").unix());Array.isArray(this.cache[e])||(this.cache[e]=[]),this.cache[e].push(t)}))}add(t){for(let e of Object.keys(t))this.dayjs.unix(parseInt(e)).isValid()&&(this.cache[e]=t[e])}purge(){for(const t of Object.keys(this.cache))delete this.cache[t]}getCachedRange(){const t=this.getDaysAsc();return{start:t.at(0),end:t.at(-1)}}getOldestDay(){const{end:t}=this.getCachedRange();return t||null}getNewestDay(){const{start:t}=this.getCachedRange();return t||null}getDaysAsc(){const t=Object.keys(this.cache);return t.sort((function(t,e){return parseInt(e)-parseInt(t)})),t.length?t.map(String):[]}getMissingRanges(t){const e=new Int32Array(t).sort();if(!e.length)return[];const a=[],n=86400;let s=e.at(0),r=null;return e.forEach((t=>{!(r&&r+n===t)&&r&&(a.push({start:String(s),end:String(r+n)}),s=t),r=t})),a.push({start:String(s),end:String(e.at(-1)+n)}),a}}(i());let p=t=>{};const v=t=>{i().extend(o()),i().extend(l()),"en"!==t&&i().locale(t)},x=t=>((0,n.useEffect)((()=>{t.onView(t.view)}),[]),(0,y.jsx)(f.A,{...t})),D=t=>(t.view&&"oneday"===t.view&&(t.view="day"),t.view&&(t.defaultView=t.view,delete t.view),t.fixedDate&&(t.fixedDate=i().unix(parseInt(t.fixedDate)).valueOf()),t),S=t=>t.map((t=>({...t,start:i().unix(parseInt(t.start)).toDate(),end:i().unix(parseInt(t.end)).toDate()}))),m=(t=null)=>t?i().unix(parseInt(t)).toDate():i()().toDate();function R(t){const{fixedDate:e,defaultView:a}=D(t),r=t.locale.name;v(r);const c=(0,s.vH)(i()),[o,d]=(0,n.useState)([]),[l,h]=(0,n.useState)(t.defaultView),f=(0,n.useCallback)((async t=>{const e={start:i()(1e3*t.start).local().toDate(),end:i()(1e3*t.end).local().endOf("day").toDate()};p({...e,range:t},"range@loadEvents");const a=w.getRange(e);if(a.cached.length&&(d(a.cached),p(a.cached,"FROM CACHE")),a.missing.length)for(const t of a.missing){p({start:i()(1e3*parseInt(t.start)).local().toString(),end:i()(1e3*parseInt(t.end)).local().toString()},"MISSING RANGE");const e=(0,u.addQueryArgs)("/osec/v1/days",t),a=await g()({path:e}),n=S(a.events);d((t=>[...t,...n])),w.addRequest(n),p({newEvents:n,cache:w},"FETCHED TO CACHE")}}),[d]),R=(t,e)=>{let a=t;switch(e){case"week":a={start:t[0],end:t[6]};break;case"agenda":a={start:t.start,end:i()(t.start).endOf("month").toDate()};break;case"day":a={start:t[0],end:i()(t[0]).endOf("day").toDate()}}return p({start:i()(a.start).toDate(),end:i()(a.end).toDate(),view:e},`loadRange for view: "${e}"`),f({start:i()(a.start).unix(),end:i()(a.end).unix()})},{getNow:A}=(0,n.useMemo)((()=>({defaultDate:m(e),getNow:()=>i()().toDate(),localizer:c})));return(0,n.useEffect)((()=>{!async function(t){const e=(0,u.addQueryArgs)("/osec/v1/days",t),a=await g()({path:e});if(a.events){const t=a.events.map((t=>({...t,start:i().unix(parseInt(t.start)).toDate(),end:i().unix(parseInt(t.end)).toDate()})));console.log(t,"@loadEvents"),d(t)}}(R)}),[R,d]),(0,y.jsx)(s.Vv,{localizer:c,events:o,getNow:A,endAccessor:"end",style:{height:"100vh",fontSize:".9rem"},defaultView:a,onRangeChange:(t,e)=>(p({newRange:t,view:l},"args@onRangeChange"),R(t,null!=e?e:l)),onView:t=>{p(t,"onView"),h(t)},components:{toolbar:x}})}}}]);