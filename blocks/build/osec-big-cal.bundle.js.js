"use strict";(globalThis.webpackChunkcalendar_block=globalThis.webpackChunkcalendar_block||[]).push([[2242],{5640:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var r=n(1609),a=n(4839),o=n(4353),s=n.n(o),i=n(6986),c=n.n(i),d=n(8569),l=n.n(d);var u=n(1455),h=n.n(u),g=n(3832),p=n(5327),f=n(5143),w=n(790);function y({position:e,childRect:t,popoverRect:n,children:r}){const a="white",o=a,s="#C1C1C1",i={backgroundColor:a,opacity:.9,padding:".5em",border:`1px solid ${s}`,borderRadius:"5px"};return(0,w.jsx)(f.ArrowContainer,{position:e,childRect:t,popoverRect:n,arrowSize:8,className:"popover-arrow-container",arrowClassName:"popover-arrow",style:{zIndex:1,overflow:"visible"},arrowColor:s,arrowStyle:function(e){switch(e){case"left":return{right:1};case"right":return{left:1};case"bottom":return{top:0};default:return{bottom:0}}}(e),children:(0,w.jsx)(f.ArrowContainer,{position:e,childRect:t,popoverRect:n,arrowSize:8,style:{paddingLeft:0,paddingTop:0,paddingBottom:0,paddingRight:0},arrowColor:o,arrowStyle:function(e,t=10){switch(e){case"left":return{right:1,borderLeft:`${t}px solid ${o}`,zIndex:1};case"right":return{left:1,borderRight:`${t}px solid ${o}`,zIndex:1};case"bottom":return{top:1,borderBottom:`${t}px solid ${o}`,zIndex:1};default:return{bottom:1,borderTop:`${t}px solid ${o}`,zIndex:1}}}(e,8),children:(0,w.jsxs)("div",{style:i,children:[r,(0,w.jsxs)("p",{style:{marginTop:"4em"},children:["I'm Event popup content (position: ",e,")."]})]})})})}function v({event:e}){const t=e.end?`End: ${e.end.toLocaleDateString()} — ${e.end.toLocaleTimeString()}`:"";return(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 .5em"},children:e.title}),(0,w.jsxs)("p",{children:["Start: ",e.start.toLocaleDateString()," — ",e.start.toLocaleTimeString(),(0,w.jsx)("br",{}),t]})]})}function x({event:e,children:t,popoverBoundary:n,selected:a}){console.log(a,"selected");const[o,s]=(0,r.useState)(a),[i,c]=(0,r.useState)(a);(0,r.useEffect)((()=>{const e=i&&setTimeout((()=>{s(!0)}),600);return()=>{clearTimeout(e)}}),[i]),(0,r.useEffect)((()=>()=>{s(!1),c(!1)}),[a,s]);const d=r.forwardRef((({children:e},t)=>(console.log(e,"children@RefTarget"),"function"==typeof t?t(e):t.current=e,null)));return(0,w.jsx)("div",{style:{position:"static",zIndex:9999},ref:d,onMouseEnter:e=>{c(!0),e.preventDefault()},onMouseLeave:e=>{a||(c(!1),s(!1),e.preventDefault())},children:(0,w.jsx)(f.Popover,{parentElement:n,boundaryInset:window.innerWidth>400?20:0,isOpen:o||a,positions:["bottom","right","left","top"],reposition:!0,content:t=>(0,w.jsx)(y,{...t,children:(0,w.jsx)(v,{event:e})}),children:t})})}const m=new class{constructor(e){this.dayjs=e,this.cache={}}getRange(e){if(!e.start||!e.end)throw new Error("invalid argument type");let t=this.dayjs(e.start).startOf("day"),n=this.dayjs(e.end).add(1,"day").startOf("day");n.isBefore(t)&&([n,t]=[t,n]);let r=this.dayjs(t);const a=[],o={};let s=[];for(;r.isBefore(n)||r.isSame(n);){const e=r.unix();Array.isArray(this.cache[String(e)])?(s=s.concat(this.cache[String(e)]),o[String(e)]=!0):null===this.cache[String(e)]?this.cache[String(e)]=[]:(a.push(e),this.cache[String(e)]=null,o[String(e)]=!1),r=r.add(1,"day")}return{temp:o,start:{date:t.local().format(),unix:t.unix()},end:{date:n.local().format(),unix:n.unix()},cached:s,missing:this.getMissingRanges(a)}}addRequest(e){e.map((e=>{const t=String(o(e.start).startOf("day").unix());Array.isArray(this.cache[t])||(this.cache[t]=[]),this.cache[t].push(e)}))}add(e){for(let t of Object.keys(e))this.dayjs.unix(parseInt(t)).isValid()&&(this.cache[t]=e[t])}purge(){for(const e of Object.keys(this.cache))delete this.cache[e]}getCachedRange(){const e=this.getDaysAsc();return{start:e.at(0),end:e.at(-1)}}getOldestDay(){const{end:e}=this.getCachedRange();return e||null}getNewestDay(){const{start:e}=this.getCachedRange();return e||null}getDaysAsc(){const e=Object.keys(this.cache);return e.sort((function(e,t){return parseInt(t)-parseInt(e)})),e.length?e.map(String):[]}getMissingRanges(e){const t=new Int32Array(e).sort();if(!t.length)return[];const n=[],r=86400;let a=t.at(0),o=null;return t.forEach((e=>{!(o&&o+r===e)&&o&&(n.push({start:String(a),end:String(o+r)}),a=e),o=e})),n.push({start:String(a),end:String(t.at(-1)+r)}),n}}(s());let S=e=>{};const b=e=>{s().extend(c()),s().extend(l()),"en"!==e&&s().locale(e)},R=e=>((0,r.useEffect)((()=>{e.onView(e.view)}),[e.view]),(0,w.jsx)(p.A,{...e})),j=e=>(e.view&&"oneday"===e.view&&(e.view="day"),e.view&&(e.defaultView=e.view,delete e.view),e.fixedDate&&(e.fixedDate=s().unix(parseInt(e.fixedDate)).valueOf()),e),C=e=>Array.isArray(e)?e.map((e=>({...e,start:s().unix(parseInt(e.start)).toDate(),end:s().unix(parseInt(e.end)).toDate()}))):[];function D(e){const{fixedDate:t,defaultView:n}=j(e),o=e.locale.name;b(o);const[i,c]=(0,r.useState)([]),[d,l]=(0,r.useState)(e.defaultView),u=(0,r.useCallback)((async e=>{const t={start:s()(1e3*e.start).local().toDate(),end:s()(1e3*e.end).local().endOf("day").toDate()};S({...t,range:e},"range@loadEvents");const n=m.getRange(t);if(n.cached.length&&(c(n.cached),S(n.cached,"FROM CACHE")),n.missing.length)for(const e of n.missing){S({start:s()(1e3*parseInt(e.start)).local().toString(),end:s()(1e3*parseInt(e.end)).local().toString()},"MISSING RANGE");const t=(0,g.addQueryArgs)("/osec/v1/days",e),n=await h()({path:t}),r=C(n.events);c((e=>[...e,...r])),m.addRequest(r),S({newEvents:r,cache:m},"FETCHED TO CACHE")}}),[c]),{getNow:p,localizer:f,popoverBoundary:y}=(0,r.useMemo)((()=>({getNow:()=>s()().toDate(),localizer:(0,a.vH)(s()),popoverBoundary:Element.prototype.querySelector.call(document.getElementById(e.id),['[class$="view"]'])}))),v=(0,r.useMemo)((()=>({eventWrapper:e=>(e.popoverBoundary=y,(0,w.jsx)(x,{...e})),toolbar:R})),[y]),D=(0,r.useRef)(null);(0,r.useEffect)((()=>()=>{window.clearTimeout(D?.current)}),[]);const E=(0,r.useCallback)((e=>{window.clearTimeout(D?.current),D.current=window.setTimeout((()=>{console.log(e,"onSelectEvent")}),250)}),[]);return(0,w.jsx)(a.Vv,{localizer:f,events:i,getNow:p,endAccessor:"end",style:{height:"100vh",fontSize:".9rem"},defaultView:n,onRangeChange:(e,t)=>(S({newRange:e,view:d},"args@onRangeChange"),c([]),((e,t)=>{let n=e;switch(t){case"week":n={start:e[0],end:e[6]};break;case"agenda":n={start:e.start,end:s()(e.start).endOf("month").toDate()};break;case"day":n={start:e[0],end:s()(e[0]).endOf("day").toDate()}}return S({start:s()(n.start).toDate(),end:s()(n.end).toDate(),view:t},`loadRange for view: "${t}"`),u({start:s()(n.start).unix(),end:s()(n.end).unix()})})(e,null!=t?t:d)),onView:e=>{S(e,"onView"),l(e)},components:v,onSelectEvent:E})}}}]);