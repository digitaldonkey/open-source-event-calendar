"use strict";(globalThis.webpackChunkcalendar_block=globalThis.webpackChunkcalendar_block||[]).push([[2242],{7847:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var a=n(1609),s=n(1356),r=n(4353),o=n.n(r),i=n(6986),c=n.n(i),l=n(8569),d=n.n(l);var h=n(1455),u=n.n(h),g=n(3832),p=n(5327),f=n(5011),v=n(790);function w(e){return console.log(e),(0,v.jsx)(f.A,{show:!0,children:(e,{arrowProps:t,popper:n,show:a})=>(0,v.jsx)("div",{...e,className:"absolute",children:"N.A."})})}function y({event:e,children:t,popupHandler:n}){return console.log({event:e,children:t,popupHandler:n}),(0,v.jsx)("div",{onMouseEnter:a=>{console.log("hover->in",a),n({event:e,target:t,show:!0},"show"),a.preventDefault()},onMouseLeave:e=>{console.log("hover->out"),n({event:null,target:null,show:!1},"hide"),e.preventDefault()},style:{position:"relative"},children:t})}const x=new class{constructor(e){this.dayjs=e,this.cache={}}getRange(e){if(!e.start||!e.end)throw new Error("invalid argument type");let t=this.dayjs(e.start).startOf("day"),n=this.dayjs(e.end).add(1,"day").startOf("day");n.isBefore(t)&&([n,t]=[t,n]);let a=this.dayjs(t);const s=[],r={};let o=[];for(;a.isBefore(n)||a.isSame(n);){const e=a.unix();Array.isArray(this.cache[String(e)])?(o=o.concat(this.cache[String(e)]),r[String(e)]=!0):null===this.cache[String(e)]?this.cache[String(e)]=[]:(s.push(e),this.cache[String(e)]=null,r[String(e)]=!1),a=a.add(1,"day")}return{temp:r,start:{date:t.local().format(),unix:t.unix()},end:{date:n.local().format(),unix:n.unix()},cached:o,missing:this.getMissingRanges(s)}}addRequest(e){e.map((e=>{const t=String(r(e.start).startOf("day").unix());Array.isArray(this.cache[t])||(this.cache[t]=[]),this.cache[t].push(e)}))}add(e){for(let t of Object.keys(e))this.dayjs.unix(parseInt(t)).isValid()&&(this.cache[t]=e[t])}purge(){for(const e of Object.keys(this.cache))delete this.cache[e]}getCachedRange(){const e=this.getDaysAsc();return{start:e.at(0),end:e.at(-1)}}getOldestDay(){const{end:e}=this.getCachedRange();return e||null}getNewestDay(){const{start:e}=this.getCachedRange();return e||null}getDaysAsc(){const e=Object.keys(this.cache);return e.sort((function(e,t){return parseInt(t)-parseInt(e)})),e.length?e.map(String):[]}getMissingRanges(e){const t=new Int32Array(e).sort();if(!t.length)return[];const n=[],a=86400;let s=t.at(0),r=null;return t.forEach((e=>{!(r&&r+a===e)&&r&&(n.push({start:String(s),end:String(r+a)}),s=e),r=e})),n.push({start:String(s),end:String(t.at(-1)+a)}),n}}(o());let D=e=>{};const S=e=>{o().extend(c()),o().extend(d()),"en"!==e&&o().locale(e)},m=e=>((0,a.useEffect)((()=>{e.onView(e.view)}),[]),(0,v.jsx)(p.A,{...e})),A=e=>(e.view&&"oneday"===e.view&&(e.view="day"),e.view&&(e.defaultView=e.view,delete e.view),e.fixedDate&&(e.fixedDate=o().unix(parseInt(e.fixedDate)).valueOf()),e),j=e=>Array.isArray(e)?e.map((e=>({...e,start:o().unix(parseInt(e.start)).toDate(),end:o().unix(parseInt(e.end)).toDate()}))):[],E=(e=null)=>e?o().unix(parseInt(e)).toDate():o()().toDate();function R(e){const{fixedDate:t,defaultView:n}=A(e),r=e.locale.name;S(r);const i=(0,s.vH)(o()),[c,l]=(0,a.useState)([]),[d,h]=(0,a.useState)(e.defaultView),p=(0,a.useCallback)((async e=>{const t={start:o()(1e3*e.start).local().toDate(),end:o()(1e3*e.end).local().endOf("day").toDate()};D({...t,range:e},"range@loadEvents");const n=x.getRange(t);if(n.cached.length&&(l(n.cached),D(n.cached,"FROM CACHE")),n.missing.length)for(const e of n.missing){D({start:o()(1e3*parseInt(e.start)).local().toString(),end:o()(1e3*parseInt(e.end)).local().toString()},"MISSING RANGE");const t=(0,g.addQueryArgs)("/osec/v1/days",e),n=await u()({path:t}),a=j(n.events);l((e=>[...e,...a])),x.addRequest(a),D({newEvents:a,cache:x},"FETCHED TO CACHE")}}),[l]),f=(e,t)=>{let n=e;switch(t){case"week":n={start:e[0],end:e[6]};break;case"agenda":n={start:e.start,end:o()(e.start).endOf("month").toDate()};break;case"day":n={start:e[0],end:o()(e[0]).endOf("day").toDate()}}return D({start:o()(n.start).toDate(),end:o()(n.end).toDate(),view:t},`loadRange for view: "${t}"`),p({start:o()(n.start).unix(),end:o()(n.end).unix()})},{getNow:R}=(0,a.useMemo)((()=>({defaultDate:E(t),getNow:()=>o()().toDate(),localizer:i})));return(0,a.useEffect)((()=>{!async function(e){const t=(0,g.addQueryArgs)("/osec/v1/days",e),n=await u()({path:t});if(n.events){const e=n.events.map((e=>({...e,start:o().unix(parseInt(e.start)).toDate(),end:o().unix(parseInt(e.end)).toDate()})));console.log(e,"@loadEvents"),l(e)}}(f)}),[f,l]),(0,v.jsx)(s.Vv,{localizer:i,events:c,getNow:R,endAccessor:"end",style:{height:"100vh",fontSize:".9rem"},defaultView:n,onRangeChange:(e,t)=>(D({newRange:e,view:d},"args@onRangeChange"),f(e,null!=t?t:d)),onView:e=>{D(e,"onView"),h(e)},components:{toolbar:m,eventWrapper:e=>(e.popupHandler=popupHandler,(0,v.jsx)(y,{...e}))},onSelectEvent:e=>(console.log("onSelectEvent",e),(0,v.jsx)(w,{...e}))})}}}]);