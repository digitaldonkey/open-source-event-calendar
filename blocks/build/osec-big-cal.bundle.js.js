"use strict";(globalThis.webpackChunkcalendar_block=globalThis.webpackChunkcalendar_block||[]).push([[2242],{5640:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var a=n(1609),r=n(4839),s=n(4353),o=n.n(s),i=n(6986),c=n.n(i),d=n(8569),l=n.n(d);var u=n(1455),h=n.n(u),g=n(3832),p=n(5327),f=n(5143),y=n(790);function w({position:e,childRect:t,popoverRect:n,children:a}){const r="white",s=r,o="#C1C1C1",i={backgroundColor:r,opacity:.9,padding:".5em",border:`1px solid ${o}`,borderRadius:"5px"};return(0,y.jsx)(f.ArrowContainer,{position:e,childRect:t,popoverRect:n,arrowSize:8,className:"popover-arrow-container",arrowClassName:"popover-arrow",style:{zIndex:1,overflow:"visible"},arrowColor:o,arrowStyle:function(e){switch(e){case"left":return{right:1};case"right":return{left:1};case"bottom":return{top:0};default:return{bottom:0}}}(e),children:(0,y.jsx)(f.ArrowContainer,{position:e,childRect:t,popoverRect:n,arrowSize:8,style:{paddingLeft:0,paddingTop:0,paddingBottom:0,paddingRight:0},arrowColor:s,arrowStyle:function(e,t=10){switch(e){case"left":return{right:1,borderLeft:`${t}px solid ${s}`,zIndex:1};case"right":return{left:1,borderRight:`${t}px solid ${s}`,zIndex:1};case"bottom":return{top:1,borderBottom:`${t}px solid ${s}`,zIndex:1};default:return{bottom:1,borderTop:`${t}px solid ${s}`,zIndex:1}}}(e,8),children:(0,y.jsxs)("div",{style:i,children:[a,(0,y.jsxs)("p",{style:{marginTop:"4em"},children:["I'm Event popup content (position: ",e,")."]})]})})})}function v({event:e}){const t=e.end?`End: ${e.end.toLocaleDateString()} — ${e.end.toLocaleTimeString()}`:"";return(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{style:{margin:"0 0 .5em"},children:e.title}),(0,y.jsxs)("p",{children:["Start: ",e.start.toLocaleDateString()," — ",e.start.toLocaleTimeString(),(0,y.jsx)("br",{}),t]})]})}function x({event:e,children:t,popoverBoundary:n}){const[r,s]=(0,a.useState)(!1),o=a.forwardRef((({children:e},t)=>("function"==typeof t?t(e):t.current=e,null)));return(0,y.jsx)("div",{style:{position:"static",zIndex:9999},ref:o,onMouseEnter:e=>{s(!0),e.preventDefault()},onMouseLeave:e=>{s(!1),e.preventDefault()},children:(0,y.jsx)(f.Popover,{parentElement:n,boundaryInset:window.innerWidth>400?20:0,isOpen:r,positions:["bottom","right","left","top"],reposition:!0,content:t=>(0,y.jsx)(w,{...t,children:(0,y.jsx)(v,{event:e})}),children:t})})}const m=new class{constructor(e){this.dayjs=e,this.cache={}}getRange(e){if(!e.start||!e.end)throw new Error("invalid argument type");let t=this.dayjs(e.start).startOf("day"),n=this.dayjs(e.end).add(1,"day").startOf("day");n.isBefore(t)&&([n,t]=[t,n]);let a=this.dayjs(t);const r=[],s={};let o=[];for(;a.isBefore(n)||a.isSame(n);){const e=a.unix();Array.isArray(this.cache[String(e)])?(o=o.concat(this.cache[String(e)]),s[String(e)]=!0):null===this.cache[String(e)]?this.cache[String(e)]=[]:(r.push(e),this.cache[String(e)]=null,s[String(e)]=!1),a=a.add(1,"day")}return{temp:s,start:{date:t.local().format(),unix:t.unix()},end:{date:n.local().format(),unix:n.unix()},cached:o,missing:this.getMissingRanges(r)}}addRequest(e){e.map((e=>{const t=String(s(e.start).startOf("day").unix());Array.isArray(this.cache[t])||(this.cache[t]=[]),this.cache[t].push(e)}))}add(e){for(let t of Object.keys(e))this.dayjs.unix(parseInt(t)).isValid()&&(this.cache[t]=e[t])}purge(){for(const e of Object.keys(this.cache))delete this.cache[e]}getCachedRange(){const e=this.getDaysAsc();return{start:e.at(0),end:e.at(-1)}}getOldestDay(){const{end:e}=this.getCachedRange();return e||null}getNewestDay(){const{start:e}=this.getCachedRange();return e||null}getDaysAsc(){const e=Object.keys(this.cache);return e.sort((function(e,t){return parseInt(t)-parseInt(e)})),e.length?e.map(String):[]}getMissingRanges(e){const t=new Int32Array(e).sort();if(!t.length)return[];const n=[],a=86400;let r=t.at(0),s=null;return t.forEach((e=>{!(s&&s+a===e)&&s&&(n.push({start:String(r),end:String(s+a)}),r=e),s=e})),n.push({start:String(r),end:String(t.at(-1)+a)}),n}}(o());let S=e=>{};const b=e=>{o().extend(c()),o().extend(l()),"en"!==e&&o().locale(e)},D=e=>((0,a.useEffect)((()=>{e.onView(e.view)}),[]),(0,y.jsx)(p.A,{...e})),R=e=>(e.view&&"oneday"===e.view&&(e.view="day"),e.view&&(e.defaultView=e.view,delete e.view),e.fixedDate&&(e.fixedDate=o().unix(parseInt(e.fixedDate)).valueOf()),e),j=e=>Array.isArray(e)?e.map((e=>({...e,start:o().unix(parseInt(e.start)).toDate(),end:o().unix(parseInt(e.end)).toDate()}))):[],I=(e=null)=>e?o().unix(parseInt(e)).toDate():o()().toDate();function C(e){const{fixedDate:t,defaultView:n}=R(e),s=e.locale.name;b(s);const i=(0,r.vH)(o()),[c,d]=(0,a.useState)([]),[l,u]=(0,a.useState)(e.defaultView),p=(0,a.useCallback)((async e=>{const t={start:o()(1e3*e.start).local().toDate(),end:o()(1e3*e.end).local().endOf("day").toDate()};S({...t,range:e},"range@loadEvents");const n=m.getRange(t);if(n.cached.length&&(d(n.cached),S(n.cached,"FROM CACHE")),n.missing.length)for(const e of n.missing){S({start:o()(1e3*parseInt(e.start)).local().toString(),end:o()(1e3*parseInt(e.end)).local().toString()},"MISSING RANGE");const t=(0,g.addQueryArgs)("/osec/v1/days",e),n=await h()({path:t}),a=j(n.events);d((e=>[...e,...a])),m.addRequest(a),S({newEvents:a,cache:m},"FETCHED TO CACHE")}}),[d]),f=(e,t)=>{let n=e;switch(t){case"week":n={start:e[0],end:e[6]};break;case"agenda":n={start:e.start,end:o()(e.start).endOf("month").toDate()};break;case"day":n={start:e[0],end:o()(e[0]).endOf("day").toDate()}}return S({start:o()(n.start).toDate(),end:o()(n.end).toDate(),view:t},`loadRange for view: "${t}"`),p({start:o()(n.start).unix(),end:o()(n.end).unix()})},{getNow:w}=(0,a.useMemo)((()=>({defaultDate:I(t),getNow:()=>o()().toDate(),localizer:i})));(0,a.useEffect)((()=>{!async function(e){const t=(0,g.addQueryArgs)("/osec/v1/days",e),n=await h()({path:t});if(n.events){const e=n.events.map((e=>({...e,start:o().unix(parseInt(e.start)).toDate(),end:o().unix(parseInt(e.end)).toDate()})));console.log(e,"@loadEvents"),d(e)}}(f)}),[f,d]);const v=Element.prototype.querySelector.call(document.getElementById(e.id),['[class$="view"]']);return(0,y.jsx)(r.Vv,{localizer:i,events:c,getNow:w,endAccessor:"end",style:{height:"100vh",fontSize:".9rem"},defaultView:n,onRangeChange:(e,t)=>(S({newRange:e,view:l},"args@onRangeChange"),f(e,null!=t?t:l)),onView:e=>{S(e,"onView"),u(e)},components:{toolbar:D,eventWrapper:e=>(e.popoverBoundary=v,(0,y.jsx)(x,{...e}))}})}}}]);